<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
        <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>
        <title>Tasklist</title>
        <script>
        $(function() {
            // Inicialitza el diàleg de jQuery UI per afegir una nova tasca
            $("#dialog").dialog({
                autoOpen: false,
                modal: true,
                buttons: {
                    "Afegir tasca": function() {
                        var tasca = $("#tascaText").val();
                        if (tasca) {
                            addTask(tasca);
                            $(this).dialog("close");
                            $("#tascaText").val(''); 
                        }
                    },
                    "Cancel·lar": function() {
                        $(this).dialog("close");
                    }
                }
            });

            // Obre el diàleg per afegir tasca
            $("#afegirTascaBtn").click(function() {
                $("#dialog").dialog("open");
            });

            // Inicialitza l'accordion
            $("#tasquesList").accordion({
                header: "> div > h3",
                collapsible: true,
                active: false
            });

            // Funció per afegir una tasca
            function addTask(tasca) {
                // Crear la capçalera (h3) i el contingut (div) per a cada panell
                var header = $('<h3></h3>').text(tasca);
                var content = $('<div></div>');
                
                // Crear els botons d'editar i eliminar dins del contingut
                var deleteBtn = $('<button>Elimina</button>').click(function(){
                    content.parent().remove();
                    $("#tasquesList").accordion("refresh");
                });
                var editBtn = $('<button>Edita</button>').click(function(){
                    editTask(header, content);
                });

                content.append(deleteBtn);
                content.append(editBtn);
                
                // Inserir el panell dins de la llista de tasques
                $("#tasquesList").append($('<div></div>').append(header).append(content));
                $("#tasquesList").accordion("refresh"); // Refresca l'accordion per incloure la nova tasca
            }

            // Funció per editar una tasca
            function editTask(header, content) {
                var originalText = header.text();
                content.html(`
                  <input type="text" class="edit-input" value="${originalText}">
                  <button class="ok-btn">OK</button>
                `);

                content.find('.ok-btn').click(function() {
                    var newText = content.find('.edit-input').val();
                    if (newText.trim()) {
                        header.text(newText);  // Actualitza la capçalera amb el nou text
                        
                        // Restaurar els botons d'editar i eliminar
                        content.html('');  
                        var deleteBtn = $('<button>Elimina</button>').click(function(){
                            content.parent().remove();
                            $("#tasquesList").accordion("refresh");
                        });
                        var editBtn = $('<button>Edita</button>').click(function(){
                            editTask(header, content);
                        });

                        content.append(deleteBtn);
                        content.append(editBtn);
                    } else {
                        alert('El text de la tasca no pot estar buit!');
                    }
                });
            }
        });
        </script>
    </head>
    <body>
        <h1>TaskList</h1>

        <div id="tasquesList">
            <div>
                <h3>Tasca 1</h3>
                <div>
                    <button>Elimina</button>
                    <button>Edita</button>
                </div>
            </div>
            <div>
                <h3>Tasca 2</h3>
                <div>
                    <button>Elimina</button>
                    <button>Edita</button>
                </div>
            </div>
        </div>

        <button id="afegirTascaBtn">Afegir Tasca</button>

        <div id="dialog" title="Afegir nova tasca">
            <label for="tascaText">Nom de la Tasca</label>
            <input type="text" id="tascaText">
        </div>
    </body>
</html>
